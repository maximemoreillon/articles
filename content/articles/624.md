+++
date = '2021-11-22'
title = "Unlocking my apartment with my face"
tags = ['AI / ML', 'Computer vision', 'ESP32', 'Python', 'IoT']
+++

As part of a previous project, I installed an [IoT lock](/articles/237) on my front door, which allowed me to control it using my smartphone. However, having to take out my smartphone every time I want to unlock the door quickly becomes annoying. To improve on the situation, I installed an RFID reader on the lock, which I used in combination with an [RFID ring which now serves as my key](/articles/523). To follow up on this trend of finding new ways to unlock my door, I decided to explore face recognition technologies.

The first step in this endeavor was to get my hands on a camera that I could use. Luckily, the ESP32 microcontroller provides support for OV2640 cameras and including those can be purchased for less than USD 10$ online. Moreover, the ESP32 can handle MQTT, which my lock can use to receive the unlock command. Here I got myself a TTGO T-camera plus as it also includes a display, useful to inform the user of what is happening.

There are various Arduino sketch available online that can interact with an OV2640 camera from the ESP32. One such sketch in particular performs face detection and even recognition. For this project, I created a firmware for the T-camera plus based on this face detection system. However, I left the face recognition aside as I didn't trust it so much and wanted to have more control on how to achieve it.

For face recognition, I used the popular [face\_recognition pip package](https://github.com/ageitgey/face_recognition). Here, I designed a simple FastAPI application that exposes the face recognition abilities of the package via HTTP requests, which the ESP32 can handle. This application also manages user registration, storing user information in a MongoDB database.

I deployed the application in K3s on an Nvidia Jetson Nano in order to benefit from GPU acceleration.

To facilitate user management, I built a simple front-end for the application using Vue.js and Vuetify.

![](https://img.maximemoreillon.com/images/619b82549a075fef0e5a079b)

With this setup, the ESP32 constantly scans for faces. When a face is detected, a frame is captured and sent to the face recognition service running on the Jetson Nano. The latter then checks the face against those stored in the user database. If a match is found, the application respond with an HTTP 200, after which the ESP32 sends an MQTT message to the lock so as to unlock the door.

The code for this project is available on GitHub:

* [ESP32 firmware](https://github.com/maximemoreillon/esp32-cam-remote-face-recognition)
* [Face recognition FastAPI app](https://github.com/maximemoreillon/face-recognition-fastapi)
* [GUI for the FastAPI app](https://github.com/maximemoreillon/face-recognition-fastapi-front)

Moreover, the web application can be deployed as docker containers, for which images can be found on Docker Hub:

* [Front-end](https://hub.docker.com/repository/docker/moreillon/face-recognition-fastapi-front)
* [Back-end](https://hub.docker.com/repository/docker/moreillon/face-recognition-fastapi)