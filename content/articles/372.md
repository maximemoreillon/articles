+++
date = '2020-03-10'
title = "Light controller with PIR sensor"
tags = ['IoT', 'ESP8266', 'Projects', 'Electronics', 'MQTT']
+++

This is an IoT ceiling light controller which includes an HC-SR501 PIR motion sensor. It is built around a Wemos D1 mini (ESP8266 breakout board), which controls a homemade TRIAC breakout board. TRIACs provide the advantage of switching devices on and off silently, as opposed to a mechanical relay.

![](https://img.maximemoreillon.com/image?id=5e7859695e7feee2d46e5744)

The system is powered from the same AC lines as the lights, thanks to an embedded AC-DC converter. This removes the need for an additional power supply.

Please note that handling mains electricity is extremely dangerous. Not only is there a high risk of electrocution, but also porrly designed devices can easily catch fire due to the high electric power involved. Attempt prjects like this one at your own risk.

Due to the configuration of my lights, I had no access to wires that I could easily feed into the system. To circumvent this issue, I hacked a LED lightbulb so as to use its socket to get powr lines out while the output of the controller feeds back int the remaining of the bulb.

![](http://maximemoreillon.com/projects/light_pir/images/light_bulb_hack.jpg)The hacked LED bulb

Although Lights triggered by a motion sensor can be bought for cheap, their motion sensor is entirely deidcated to turning the light on and off. Thus, they cannot be used for other applications such as intrusion detctors. With this project, the motion sensor output can not only be used to turn the light on or off but also trigger any action available in my home automation system. Upon detection of movement, an MQTT message is published, which can be listened to by any device subscribed to the corresponding topic.

Hardware
--------

### Main board

Parts

* Wemos D1 mini
* HC-SR501 PIR motion sensor
* TRIAC breakout board
* AC-DC converter

![](http://maximemoreillon.com/projects/light_pir/images/light_pir_schematic.png)Schematic

The details of the custom TRIAC breakout board are given hereunder.

![](http://maximemoreillon.com/projects/light_pir/images/triac_breakout_schematic.png)Schematic for the TRIAC breakout board

Parts used:

* [NXP BT136 600E](http://www.mouser.com/ds/2/302/BT136-600E-352978.pdf) TRIAC
* [MOC3041](http://exa.unne.edu.ar/ingenieria/sysistemas/public_html/Archi_pdf/HojaDatos/Optoelectronica/moc3041.pdf) TRIAC driver
* 330 Ohm resistor

The firmware running on the ESP8266 is available on [GitHub](https://github.com/maximemoreillon/light_pir_combo).