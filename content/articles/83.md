+++
date = '2020-03-09'
title = "IoT Current consumption monitoring system"
tags = ['MQTT', 'Projects', 'IoT', 'Node.js', 'Electronics', 'InfluxDB']
+++

When you don't know how much power your air conditioner draws, it's easy to leave it running without feeling too guilty. And then the electricity bill comes...

The objective of this project is to get an approximate measurement of how much electric power is being used in my apartment. Additionally, for the sake of safety, the measurement system should not require altering the electrical wiring currently in place. In other words, the measurement should be non-invasive.

To this end, I built a current measuring system based on transformers (CT) and an ESP32 Wifi microcontroller.

The system is installed on the breaker box of my apartment.

![](https://img.maximemoreillon.com/image?id=5e786e4b6f2c2a628a19cad5)

This system has been designed following [the instructions provided by openeneregymonitor.org](https://learn.openenergymonitor.org/electricity-monitoring/ct-sensors/interface-with-arduino), which does a far better job at explaining how things work than I possibly could. At the moment, I am only measuring current, which limits me to computing my apartment's [aparent power consumption, as opposed to its true power consumption](https://www.allaboutcircuits.com/textbook/alternating-current/chpt-11/true-reactive-and-apparent-power/).

![](https://img.maximemoreillon.com/image?id=5e7993432143b0076cbdf008)

The electrical system of my apartment is in a [split-phase configuration](https://en.wikipedia.org/wiki/Split-phase_electric_power). This required me to use two CT sensors, one per phase, as explained in [this guide provided by Maxim Integrated](https://pdfserv.maximintegrated.com/en/an/AN4843.pdf).

![](https://img.maximemoreillon.com/image?id=5e7992fa2143b00811bdf006)

The CTs output are processed by an ESP32, which I chose over an ESP8266 because of its multiple ADCs. This allows for the periodic broadcast of the measurements over MQTT. Additionally, the ESP32 serves webpages for real-time visualizatation of the power consumption. The web server used to serve those pages also provides the ability to update the firmware running on the ESP32 for OTA updates.

Here is a list of the parts used in this project:

* ESP32 dev board
* 2x YHDC SCT-013-000 current transformer
* 2x 22Ω resistor (burden, a.k.a. shunt resistor for the CT)
* 2x 10kΩ resistor
* 10μF electrolytic capacitor

![](https://img.maximemoreillon.com/image?id=5e79931b2143b0ee5ebdf007)

Additionally, I created a NodeJS application to log the measurements in an InfluxDB. It comes with a front end built using VueJS.

![](https://img.maximemoreillon.com/image?id=5e7992d02143b0293cbdf005)

The source code for this project is available on GitHub:

* [ESP32 firmware](https://github.com/maximemoreillon/power_monitor_split_phase)
* [Monitoring microservice back end](https://github.com/maximemoreillon/current_consumption)
* [Monitoring GUI](https://github.com/maximemoreillon/current_consumption_front)

More information about the electronics on [OSHWLab](https://oshwlab.com/m.moreillon/power_monitor).