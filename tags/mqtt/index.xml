<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>MQTT on Maxime Moreillon</title>
    <link>https://articles.maximemoreillon.com/tags/mqtt/</link>
    <description>Recent content in MQTT on Maxime Moreillon</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 03 May 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://articles.maximemoreillon.com/tags/mqtt/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>MQTThree</title>
      <link>https://articles.maximemoreillon.com/articles/2e301bdf-99eb-49cc-8c11-02ac8f0a4f72/</link>
      <pubDate>Wed, 03 May 2023 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/2e301bdf-99eb-49cc-8c11-02ac8f0a4f72/</guid>
      
      <description>&lt;p&gt;Recently, I&amp;rsquo;ve been working on a few projects involving digital twins. At its core, a digital twin is simply a digital representation, oftentimes in 3D, of a physical system. Such representation commonly provides information about the system as well as ways of interactions. On the physical system, this is can be accomplished with IoT devices.&lt;/p&gt;
&lt;p&gt;Having to build a dedicated application for each digital twin would be tedious so I designed a simple framework to make the process more convenient. The framework uses Three.js for the 3D representation of the system and MQTT to interact with its IoT devices, which led to the name MQTThree.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>IoT sensor module</title>
      <link>https://articles.maximemoreillon.com/articles/f0b88a38-7271-4f8d-8f60-05efbdd861cc/</link>
      <pubDate>Mon, 11 Jul 2022 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/f0b88a38-7271-4f8d-8f60-05efbdd861cc/</guid>
      
      <description>&lt;p&gt;Although a wide variety of sensing devices can be envisioned for home automation systems, motion and temperature sensors are among the most widespread. This is mostly due to their low cost and simplicity of use. In order to equip multiple rooms of my apartment with such sensors, I designed a simple IoT sensing module that can easily be produced in any quantity.&lt;/p&gt;
&lt;p&gt;The module is designed around an Wemos D1 mini (ESP8266 module) which interfaces with a HC-SR501 PIR motion sensor and Dallas DS18B20 temperature sensor. Additionally, since the Wemos still had a lot of available pins available, I added a photoresistor to measure illuminance.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>MQTT Logger</title>
      <link>https://articles.maximemoreillon.com/articles/5aa92bbf-956c-43a9-8f3c-e0bdacd6412d/</link>
      <pubDate>Sat, 09 Jul 2022 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/5aa92bbf-956c-43a9-8f3c-e0bdacd6412d/</guid>
      
      <description>&lt;p&gt;Over the years, I&amp;rsquo;ve used various IoT sensors which collect data that is then broadcast using MQTT. Those sensors generally broadcast individual measurements without saving any form of history locally. Consequently, if one would want to plot time-series graphs, the data would first need to be stored somewhere. This is the objective of the application presented in this article, named MQTT Logger.&lt;/p&gt;
&lt;p&gt;MQTT Logger is a Node.js application which subscribes to MQTT topics of IoT sensors and stores the data that those published in an InfluxDB time-series database.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Encrypted Mosquitto broker in Kubernetes</title>
      <link>https://articles.maximemoreillon.com/articles/506/</link>
      <pubDate>Tue, 26 Oct 2021 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/506/</guid>
      
      <description>&lt;p&gt;Note: an updated version of this article has been posted to &lt;a href=&#34;https://moreillon.medium.com/encrypted-mosquitto-mqtt-broker-in-kubernetes-26bb7acd11c7&#34;&gt;Medium&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Mosquitto can usually be installed on an Ubuntu server fairly easily using the APT package manager. By Default, the broker handles unencrypted MQTT connections but it can be configured to use SSL certificates obtained, for example, using Certbot and thus enable MQTTs connections. This configuration is usually achieved by editing the Mosquitto configuration file in /etc/mosquitto so as to point to certificates obtained independently. However, when deploying Mosquitto to Kubernetes, one would prefer not to edit configuration files manually after install. Moreover, in Kubernetes, one can use Cert-manager to obtain SSL certificates. Thus, this article presents an efficient method to deploy a secure MQTTs broker in Kubernetes.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>MQTT control dashboard</title>
      <link>https://articles.maximemoreillon.com/articles/555/</link>
      <pubDate>Tue, 28 Sep 2021 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/555/</guid>
      
      <description>&lt;p&gt;With the cloud native multi-user MQTT platform deployed, I started designing IoT devices that I could distribute to end users. However, without a GUI, interacting with those devices would be difficult. Of course, one could install applications like MQTT dash or similar but this would require tedious configuration such as MQTT broker and topics. I wanted to give users a simpler UX so I made this simple control interface that automatically displays a users devices and allows those to be controlled.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>SONOFF S20 firmware</title>
      <link>https://articles.maximemoreillon.com/articles/587/</link>
      <pubDate>Sat, 25 Sep 2021 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/587/</guid>
      
      <description>&lt;p&gt;The SONOFF S20 is a cheap Wifi smart socket that enables the remote control of appliances for less than USD 10. Although the hardware is more than decent, its usage requires a proprietary app which most likely involves a third party server between the user and the device. Since the socket uses an ESP8266 at its core, I decided to write my own firmware for it.&lt;/p&gt;
&lt;p&gt;I designed the firmware so as to control the socket via MQTT messages. I also added a web server that serves a simple UI for configuration and firmware updates. Initially, the firmware was flashed using the exposed UART connector inside the SONOFF S20.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>IoT infrared controller</title>
      <link>https://articles.maximemoreillon.com/articles/538/</link>
      <pubDate>Mon, 20 Sep 2021 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/538/</guid>
      
      <description>&lt;p&gt;Although probably in the decline, infrared is a common way to remotely control household appliances such as air conditioners or TVs. Being able to turn on an AC unit without leaving the sofa is definitely comfortable, but sometimes it would be even better to be able to do it before even getting home. In order to control those various appliances, I designed a simple WiFi controlled IR emitter.&lt;/p&gt;
&lt;p&gt;The device consists of an ESP8266, an IR LED and IR receiver. The IR receiver is used to record IR signals from the original remote controller of the appliances. Those signals are stored in the ESP8266, which can then replay those using the IR LED.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Multi-user MQTT platform</title>
      <link>https://articles.maximemoreillon.com/articles/485/</link>
      <pubDate>Mon, 20 Sep 2021 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/485/</guid>
      
      <description>&lt;p&gt;Mosquitto is usually the first candidate to come to mind when looking for an MQTT broker. However, by default, Mosquitto manages users using a password file. This makes it difficult to easily add or remove users, especially when the broker is deployed in Kubernetes.&lt;/p&gt;
&lt;p&gt;I recently stumbled upon the &lt;a href=&#34;https://github.com/iegomez/mosquitto-go-auth&#34;&gt;mosquitto-go-auth plugin&lt;/a&gt;, which allows for the authentication to be performed by an external service, by connecting to the latter via, for example, HTTP requests.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>IoT pan-tilt platform</title>
      <link>https://articles.maximemoreillon.com/articles/458/</link>
      <pubDate>Thu, 04 Feb 2021 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/458/</guid>
      
      <description>&lt;p&gt;With the COVID-19 pandemic, many of us cannot participate in family gatherings or other similar events in person. Instead, some opt for video-call applications like zoom, but then get constrained to the field of view of camera of the device used for the call.&lt;/p&gt;
&lt;p&gt;In order to look around more freely, I modified this off the shelf pan-tilt platform so as to be controlled by MQTT from anywhere in the world.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Encrypting Mosquitto using Certbot</title>
      <link>https://articles.maximemoreillon.com/articles/497/</link>
      <pubDate>Sat, 28 Nov 2020 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/497/</guid>
      
      <description>&lt;p&gt;The Mosquitto server must be configured using the /etc/mosquitto/conf.d/main.conf file, inside which the path to SSL certificates must be specified. A good topic on the matter can be found &lt;a href=&#34;https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-the-mosquitto-mqtt-messaging-broker-on-ubuntu-18-04-quickstart&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Certificates can be retrieved using Certbot, but for configurations where a microk8s instance is running with the NGINX Ingress controller, A special access for Certbot to fulfill its challenges is required.&lt;/p&gt;
&lt;p&gt;To do so, one can create a endpoint with a port on which certbot will listen, alongside a service and Ingress for it:&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Control IoT devices with a Xiaomi Mi Band 2</title>
      <link>https://articles.maximemoreillon.com/articles/166/</link>
      <pubDate>Tue, 10 Mar 2020 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/166/</guid>
      
      <description>&lt;p&gt;Smartwatches can be rather expensive and tend to be known for their poor battery life. On the other hand, Xiaomi&amp;rsquo;s Mi band 2 is cheap and its battery lasts for up to 20 days. However, the Mi band 2 is mainly limited to fitness tracking functions, at least without the appropriate apps.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://img.maximemoreillon.com/images/61484d8e5d171a8106416cd4&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;The objective of this project was to take advantage of the Mi Band 2&amp;rsquo;s connection with a smartphone to control IoT devices.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Home automation</title>
      <link>https://articles.maximemoreillon.com/articles/391/</link>
      <pubDate>Tue, 10 Mar 2020 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/391/</guid>
      
      <description>&lt;p&gt;Few would argue that having lights turned on in a room without occupant is a waste of electricity. Ideally, lights and other appliances like air conditioners would only be turned on when someone is around. This project is a NodeJS application that gathers data about the occupancy of an apartment and manages appliances accordingly.&lt;/p&gt;
&lt;p&gt;Over the years, I modified all the lights, air conditioners and heaters of my apartment so as to control them via MQTT. In the process, I also deployed multiple sensors among which are PIR motion sensors. This node app subscribes to the MQTT topics of all motion sensors and determines in which room the user is based on which sensor was triggered.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>IoT air conditioner controller</title>
      <link>https://articles.maximemoreillon.com/articles/185/</link>
      <pubDate>Tue, 10 Mar 2020 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/185/</guid>
      
      <description>&lt;p&gt;Air conditioners consume a fair amount of electricity. As such, forgetting to turn one off before leaving one&amp;rsquo;s home can result in an expensive electricity bill. This is a Wi-Fi enabled controller for air conditioners, which can turn the unit on or off according to MQTT messages. It is built around an Wemos D1 mini and interfaces with the AC using an IR LED.&lt;/p&gt;
&lt;p&gt;The Wemos D1 mini drives the infrared LED so as to send signals identical to that of the original remote controller of the AC. Those signals must first be recorded, which can be done with an IR receiver connected to an Arduino running &lt;a href=&#34;https://www.analysir.com/blog/2014/03/19/air-conditioners-problems-recording-long-infrared-remote-control-signals-arduino/&#34;&gt;this sketch&lt;/a&gt;.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Light controller with PIR sensor</title>
      <link>https://articles.maximemoreillon.com/articles/372/</link>
      <pubDate>Tue, 10 Mar 2020 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/372/</guid>
      
      <description>&lt;p&gt;This is an IoT ceiling light controller which includes an HC-SR501 PIR motion sensor. It is built around a Wemos D1 mini (ESP8266 breakout board), which controls a homemade TRIAC breakout board. TRIACs provide the advantage of switching devices on and off silently, as opposed to a mechanical relay.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://img.maximemoreillon.com/image?id=5e7859695e7feee2d46e5744&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;The system is powered from the same AC lines as the lights, thanks to an embedded AC-DC converter. This removes the need for an additional power supply.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Smart home control panel (SHCP)</title>
      <link>https://articles.maximemoreillon.com/articles/154/</link>
      <pubDate>Tue, 10 Mar 2020 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/154/</guid>
      
      <description>&lt;p&gt;I&amp;rsquo;ve been using &lt;a href=&#34;https://www.home-assistant.io/&#34;&gt;Home Assistant&lt;/a&gt; to control my home IoT devices for a while. Although it fulfills all my needs, I wanted to make my own system so as to get a fully customized smart home control panel and learn how to build such an application in the process.&lt;/p&gt;
&lt;p&gt;A simple way to build such an app would be to open the port corresponding to MQTT on my router and make an UI in JavaScript with an MQTT client-side library to communicate with the devices directly. However, for security reasons, I prefer to open only web-related ports to the public. Moreover, my MQTT traffic is currently unencrypted so it would not be wise to use it on a public network. Ideally, I would like to keep all MQTT communication internally with the MQTT port closed on my router, communicating via encrypted TCP traffic. For this purpose, I built a &lt;a href=&#34;https://nodejs.org/&#34;&gt;Node.js&lt;/a&gt; app that interacts with the outside world through HTTPS and then communicates with IoT devices internally.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Solar power setup</title>
      <link>https://articles.maximemoreillon.com/articles/186/</link>
      <pubDate>Tue, 10 Mar 2020 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/186/</guid>
      
      <description>&lt;p&gt;I got my hands on a 600W 12V inverter so I decided to experiment with generating my own electricity.&lt;/p&gt;
&lt;p&gt;The inverter converts 12V DC power into 100V AC electricity which can be used for household appliances. Here, the 12V DC power is supplied by a 45Ah lead-acid battery, which would allow the inverter to run at full power for slightly short of an hour.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://img.maximemoreillon.com/images/62b91cd73bbcbae9ee77c094&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;The battery is charged by a 30W solar panel, through a 10A solar charge controller. Thus, with full sunlight, the battery would theoretically be charged in about 18 hours. I don&amp;rsquo;t intend to use the inverter on a daily basis so the slow rate of charge isn&amp;rsquo;t so much of a limitation. If needed, I could still add another solar panel in parallel in order to boost the charging current.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>IoT ceiling lights</title>
      <link>https://articles.maximemoreillon.com/articles/180/</link>
      <pubDate>Mon, 09 Mar 2020 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/180/</guid>
      
      <description>&lt;p&gt;After experimenting with various options to make my existing lights smarter, I decided that designing my own hardware would provide me with more customization options. The result are those ceiling lights, made out of an aluminum frame and COB LEDs.&lt;/p&gt;
&lt;p&gt;Here, white COB LEDs provide most of luminance but the lights also feature RGB LED strips to add color to the lighting.&lt;/p&gt;
&lt;p&gt;The LEDs are controlled by a custom PCB which embeds MOSFETs for each color channel, driven by an ESP8266. Here, PWM is used to provide a dimming feature.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>IoT Current consumption monitoring system</title>
      <link>https://articles.maximemoreillon.com/articles/83/</link>
      <pubDate>Mon, 09 Mar 2020 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/83/</guid>
      
      <description>&lt;p&gt;When you don&amp;rsquo;t know how much power your air conditioner draws, it&amp;rsquo;s easy to leave it running without feeling too guilty. And then the electricity bill comes&amp;hellip;&lt;/p&gt;
&lt;p&gt;The objective of this project is to get an approximate measurement of how much electric power is being used in my apartment. Additionally, for the sake of safety, the measurement system should not require altering the electrical wiring currently in place. In other words, the measurement should be non-invasive.&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Mosquitto</title>
      <link>https://articles.maximemoreillon.com/articles/315/</link>
      <pubDate>Tue, 17 Dec 2019 00:00:00 +0000</pubDate>
      
      <guid>https://articles.maximemoreillon.com/articles/315/</guid>
      
      <description>&lt;p&gt;Mosquitto is an open source message broker that implements the MQTT protocol. It is lightweight and is suitable for use on all devices from low power single board computers to full servers.&lt;/p&gt;
&lt;h2 id=&#34;installation&#34;&gt;Installation&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo apt install mosquitto mosquitto-clients
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;setup&#34;&gt;Setup&lt;/h2&gt;
&lt;p&gt;Place a .conf file in /etc/mosquitto/conf.d&lt;/p&gt;
&lt;h3 id=&#34;setting-up-a-listener&#34;&gt;Setting up a listener&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;listener 1883
protocol mqtt
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Also available for websockets:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;listener 9001
protocol websockets
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;setting-up-authentication&#34;&gt;Setting up authentication&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;allow_anonymous false
password_file /etc/mosquitto/passwd
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;the file /etc/mosquitto/passwd can be created using an utility provided by mosquitto (run as root):&lt;/p&gt;</description>
      
    </item>
    
  </channel>
</rss>
